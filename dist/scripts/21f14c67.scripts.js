"use strict";var app=angular.module("uxArmyUiApp",["ngCookies","ngResource","ngSanitize","ngRoute","header-directives","config"]);app.config(["$routeProvider","$httpProvider",function(a,b){b.interceptors.push("AuthInterceptor"),a.when("/",{templateUrl:"views/main.html",controller:"SignupFormCtrl"}).when("/privacy-policy",{templateUrl:"views/privacy-policy.html"}).when("/thank-you",{templateUrl:"views/thank-you.html"}).when("/demo-form",{templateUrl:"views/demo-form.html",controller:"DemoFormCtrl"}).when("/error-page",{templateUrl:"views/error-page.html"}).when("/form-finish",{templateUrl:"views/form-finish.html"}).when("/sign-in",{templateUrl:"views/sign-in.html",controller:"AuthCtrl"}).when("/dashboard/",{templateUrl:"views/dashboard.html",controller:"DashboardCtrl"}).when("/participant-profile/:profileId",{templateUrl:"views/participant-profile.html",controller:"ParticipantCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("config",[]).constant("ENV",{name:"production",API_SERVER:"http://ux-army-api.herokuapp.com/"}),app.controller("SignupFormCtrl",["$scope","$http","ENV",function(a,b,c){a.postSuccess=function(){window.location="#thank-you"},a.submitSignUpForm=function(){b({url:c.API_SERVER+"api/",method:"POST",data:a.formData}).success(function(b){a.formResponse=b,a.postSuccess()})}}]),app.controller("DemoFormCtrl",["$scope","$http","ENV",function(a,b,c){a.parser=document.createElement("a"),a.$watch("url",function(){a.parser.href=a.url}),a.getParticipantData=function(){a.url=window.location,a.hashed=a.url.hash.replace("#/demo-form#","");var d={hashed:a.hashed};a.demoFormCheckError=function(){window.location="#error-page"},b({url:c.API_SERVER+"demo-form-check/",method:"POST",data:d}).success(function(b){a.checkedName=b.name,a.checkedEmail=b.email,a.checkedId=b.id}).error(function(){a.demoFormCheckError()})},a.getParticipantData(),b.get(c.API_SERVER+"choices/").success(function(b){a.genderChoices=b.genderChoices,a.birthYearChoices=b.birthYearChoices,a.stateChoices=b.stateChoices,a.jobChoices=b.jobChoices,a.employmentChoices=b.employmentChoices,a.incomeChoices=b.incomeChoices,a.experienceChoices=b.experienceChoices,a.hoursOnlineChoices=b.hoursOnlineChoices,a.educationLevelChoices=b.educationLevelChoices,a.participateTimeChoices=b.participateTimeChoices}),a.postSuccess=function(){window.location="#thank-you"},a.submitDemoForm=function(){b({url:c.API_SERVER+"api/"+a.checkedId+"/",method:"PUT",data:a.formData}).success(function(b){a.formResponse=b,a.postSuccess()})}}]),app.controller("AuthCtrl",["$scope","$location","AuthService",function(a,b,c){return localStorage.token?void b.path("/dashboard"):void(a.login=function(){var d=a.loginUsername,e=a.loginPassword;d&&e?c.login(d,e).then(function(){b.path("/dashboard")},function(){a.loginError="Incorrect username or password",a.loginPassword=null}):a.error="Username and password required"})}]),app.controller("DashboardCtrl",["$scope","$http","$location","ENV","AuthService",function(a,b,c,d,e){if(!localStorage.token)return void c.path("/sign-in");a.token=localStorage.token,a.username=localStorage["user.name"];({headers:{Authorization:"Token "+a.token}});a.page=1,a.total=0,a.totalShown=0,a.more=!1,a.populating=!1,a.users=[],a.populate=function(c){b({method:"GET",url:d.API_SERVER+"api/?page="+c}).success(function(b){a.users=a.users.concat(b.results),a.total=b.count,a.itemsPerPage=b.results.length,a.totalShown=24*a.page,a.isShownMoreThanTotal()})},a.nextPage=function(){!a.populating&&a.more&&(a.page=a.page+1,a.populate(a.page))},a.isShownMoreThanTotal=function(){a.more=a.totalShown>=a.total?!1:!0},a.populate(a.page),a.logout=function(){e.logout().then(function(){c.path("/sign-in")},function(b){a.error=b})}}]),app.controller("ParticipantCtrl",["$scope","$http","$location","$routeParams","AuthService","ENV",function(a,b,c,d,e,f){if(!localStorage.token)return void c.path("/sign-in");a.token=localStorage.token,a.username=localStorage["user.name"];var g={headers:{Authorization:"Token "+a.token}};a.getParticipantData=function(){b.get(f.API_SERVER+"api/"+d.profileId+"/",g).success(function(b){a.formData=b,a.currentProfileId=a.formData.id;var c=new Date,d=c.getFullYear();return a.age=d-a.formData.birthYear,null===a.formData.birthYear?(a.age=null,a.age):void 0}).error(function(){alert("User does not exist!"),c.path("/dashboard")})},a.getParticipantData(),b.get(f.API_SERVER+"choices/").success(function(b){a.genderChoices=b.genderChoices,a.birthYearChoices=b.birthYearChoices,a.stateChoices=b.stateChoices,a.jobChoices=b.jobChoices,a.employmentChoices=b.employmentChoices,a.incomeChoices=b.incomeChoices,a.experienceChoices=b.experienceChoices,a.hoursOnlineChoices=b.hoursOnlineChoices,a.educationLevelChoices=b.educationLevelChoices,a.participateTimeChoices=b.participateTimeChoices}),a.submitEditForm=function(){b({url:f.API_SERVER+"api/"+a.currentProfileId+"/",method:"PUT",data:a.formData}).success(function(b){a.formResponse=b,$("#editModal").modal("hide"),$(".modal-backdrop").remove(),a.getParticipantData()})},a.deleteUser=function(){b.delete(f.API_SERVER+"api/"+a.currentProfileId+"/").success(function(){$("#deleteModal").modal("hide"),$(".modal-backdrop").remove(),c.path("/dashboard")})},a.logout=function(){e.logout().then(function(){c.path("/sign-in")},function(b){a.error=b})},$(window).on("hashchange",function(){$(".modal-backdrop").remove()})}]);var app=angular.module("header-directives",[]);app.directive("headerDefault",function(){return{restrict:"E",templateUrl:"views/headers/header-default.html"}}),app.directive("headerPost",function(){return{restrict:"E",templateUrl:"views/headers/header-post.html"}}),app.factory("AuthService",["$http","$window","$q","ENV",function(a,b,c,d){var e=function(e,f,g){var h=d.API_SERVER+g,i=c.defer();return a.post(h,"username="+e+"&password="+f,{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(a){var c=a.data.token;c?(b.localStorage.token=c,localStorage["user.name"]=e,i.resolve(!0)):i.reject("Invalid data from server")},function(a){i.reject(a.data.error)}),i.promise},f=function(){var e=c.defer(),f=d.API_SERVER+"logout/";return a.post(f).then(function(){b.localStorage.removeItem("token"),b.localStorage.removeItem("username"),e.resolve()},function(){b.localStorage.removeItem("token"),b.localStorage.removeItem("username"),e.resolve()}),e.promise};return{login:function(a,b){return e(a,b,"login/")},logout:function(){return f()}}}]),app.factory("AuthInterceptor",["$rootScope","$q","$window","$location",function(a,b,c,d){return{request:function(a){return a.headers=a.headers||{},c.localStorage.token&&(a.headers.Authorization="Token "+c.localStorage.token),a},responseError:function(a){return 401===a.status?(c.localStorage.removeItem("token"),c.localStorage.removeItem("user.name"),void d.path("/sign-in")):b.reject(a)}}}]),app.directive("infiniteScroll",["$window",function(a){return{link:function(b,c,d){var e,f;a=angular.element(a),a.bind("scroll",function(){f=a.height()+a.scrollTop(),e=c.offset().top+c.innerHeight(),f==$(document).height()&&b.$apply(d.infiniteScroll)})}}}]);